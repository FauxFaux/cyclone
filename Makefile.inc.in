# -*- Makefile -*-

# Assume with Windows

O := o
A := a
EXE := .exe

# What we do when using VC++
ifdef MS
  O := obj
  A := lib
endif

# If there's no sign of a Cygwin environment, it's unix
ifndef MS
  ifndef CYGWIN
    ifneq ($(OS),Windows_NT)
      ifneq ($(OSTYPE),cygwin)
        O := o
        A := a
        EXE :=
      endif
    endif
  endif
endif

CYCLONE_LIBS:=arg\
	inet\
        array\
        assert\
        bitvec\
        buffer\
        core\
        dict\
	dirent\
	execinfo\
	fcntl\
        filename\
        fn\
        getopt\
        getopt1\
	grp\
        hashtable\
        lexing\
        lineno\
        list\
	marshal\
	mman\
        netdb\
        in\
        position\
        pp\
	printf\
	pwd\
        queue\
        rope\
	scanf\
        set\
	signal\
        slowdict\
        splay\
	stat\
	stdio\
        stdlib\
        string\
        socket\
        time\
        typerep\
	unistd\
	utime\
        xarray

CYCLONE_H:=arg.h\
	arpa/cinet.h\
	arpa/inet.h\
	array.h\
	assert.h\
	bitvec.h\
	buffer.h\
	cassert.h\
	cctype.h\
	cdirent.h\
	cerrno.h\
	cfcntl.h\
	cgetopt.h\
	cgrp.h\
	cmath.h\
	cnetdb.h\
	core.h\
	cpwd.h\
	csignal.h\
	cstddef.h\
	cstdio.h\
	cstdlib.h\
	cstring.h\
	cstrings.h\
	ctime.h\
	ctype.h\
	cunistd.h\
	cutime.h\
	dict.h\
	dirent.h\
	errno.h\
	execinfo.h\
	fcntl.h\
	filename.h\
	fn.h\
	getopt.h\
	grp.h\
	hashtable.h\
	lexing.h\
	lineno.h\
	list.h\
	marshal.h\
	math.h\
	netdb.h\
	netinet/cin.h\
	netinet/ctcp.h\
	netinet/in.h\
	netinet/tcp.h\
	position.h\
	pp.h\
	pwd.h\
	queue.h\
	rope.h\
	set.h\
	signal.h\
	signal.h\
	slowdict.h\
	splay.h\
	stddef.h\
	stdio.h\
	stdlib.h\
	string.h\
	strings.h\
	sys/cmman.h\
	sys/cresource.h\
	sys/cselect.h\
	sys/csocket.h\
	sys/cstat.h\
	sys/ctime.h\
	sys/ctypes.h\
	sys/cwait.h\
	sys/mman.h\
	sys/resource.h\
	sys/select.h\
	sys/socket.h\
	sys/stat.h\
	sys/time.h\
	sys/types.h\
	sys/wait.h\
	time.h\
	typerep.h\
	unistd.h\
	utime.h\
	xarray.h

CYCLONE_SRCS:=absyn\
         parse_tab\
         lex\
         absynpp\
	 absyndump\
         tcenv\
         tcutil\
         tcstmt\
         tcpat\
         tcexp\
	 tcgenrep\
	 formatstr\
         evexp\
         tc\
         toc\
         tovc\
         cf_flowinfo\
         new_control_flow\
         interface\
	 tcdecl\
	 cyclone

CYCDOC_SRCS:=cycdoc\
	lex\
	parse_tab\
	absyn\
	tcutil\
	tcenv\
	tcexp\
	tcstmt\
	tcpat\
        tc\
	tcdecl\
	tcgenrep\
	new_control_flow\
	cf_flowinfo\
	formatstr\
	evexp\
	absynpp

# Add XML library .h files to CYCLONE_H
ifndef NO_XML_LIB
CYCLONE_H := $(CYCLONE_H) xml/xml.h xml/xmldump.h xml/xmlparse.h 
endif

# Makefiles assume this is only one file, but they could be changed.
RUNTIME:=runtime_cyc

CYCLIB:=libcyc.$(A)
CYCCOMP:=cyclone$(EXE)

#jcheney: added cycdoc so that it gets included in update file list
C_SRCS:=$(addsuffix .c, $(CYCLONE_SRCS))
C_LIBS:=$(addsuffix .c, $(CYCLONE_LIBS))
O_SRCS:=$(addsuffix .$(O), $(CYCLONE_SRCS))
O_LIBS:=$(addsuffix .$(O), $(CYCLONE_LIBS))
C_RUNTIME:=$(addsuffix .c, $(RUNTIME))

UPDATE_SRCS:=$(addsuffix .c, $(CYCLONE_SRCS) cycdoc)

PATCH_ARCH=i686-unknown-linux
DEVEL_ARCHS := i686-unknown-linux i686-unknown-cygwin1.3.3
